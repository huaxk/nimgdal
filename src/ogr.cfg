[n.global]
src_version = "2.2.4"
output = "wrap"

[n.include]
"${output}/gdal/gcore"
"${output}/gdal/port"
"${output}/gdal/ogr"

# [n.prepare]
# gitremote = "https://github.com/OSGeo/gdal.git"
# # gitcheckout = "-b release/2.2"
# gitsparse = """
# gdal/port/*
# gdal/gcore/*
# gdal/ogr/*
# """

[n.exclude]
cpl_config.h
gdal_version.h

[n.wildcard]
wildcard = "ogr_core.h"
search.CPL_WARN_DEPRECATED = "void CPL_DLL *OGRMalloc( size_t ) CPL_WARN_DEPRECATED("Use CPLMalloc instead.");"
comment.CPL_WARN_UNUSED_RESULT = 5
wildcard = "ogr_api.h"
search.CPL_WARN_UNUSED_RESULT = "CPL_WARN_UNUSED_RESULT"
replace.CPL_WARN_UNUSED_RESULT = ""
search.CPL_WARN_DEPRECATED = """int    CPL_DLL OGR_G_Intersect( OGRGeometryH, OGRGeometryH ) CPL_WARN_DEPRECATED("Non standard method. Use OGR_G_Intersects() instead");"""
comment.CPL_WARN_DEPRECATED = 5

[wrap/gdal/port/cpl_config.h]
create = """
# define SIZEOF_INT 4
# define SIZEOF_UNSIGNED_LONG 4
#ifdef _WIN64
# define SIZEOF_VOIDP 8
#else
# define SIZEOF_VOIDP 4
#endif
# define HAVE_LONG_LONG 1
"""

[wrap/gdal/ogr/ogr_api.h]
preprocess = true
defines = true
recurse = true

dynlib.win = libgdal.dll
dynlib.lin = libgdal.so
dynlib.osx = libgdal.dylib

[ogr_api.nim]
search.1 = "  _CPLXMLNode* {.bycopy.} = object"
comment.1 = 1
search.import = "import wrap/cpl_progress"
comment.import = 3
prepend = """
import cpl_progress
import cpl_minixml
import cpl_port
import ogr_core
export ogr_core
"""
search.OGRGeometryH = "OGRGeometryH* = pointer"
replace.OGRGeometryH = "OGRGeometry = object\n  OGRGeometryH* = ptr OGRGeometry"
search.OGRSpatialReferenceH = "OGRSpatialReferenceH* = pointer"
replace.OGRSpatialReferenceH = "OGRSpatialReference = object\n  OGRSpatialReferenceH* = ptr OGRSpatialReference"
search.OGRCoordinateTransformationH = "OGRCoordinateTransformationH* = pointer"
replace.OGRCoordinateTransformationH = "OGRCoordinateTransformation = object\n  OGRCoordinateTransformationH* = ptr OGRCoordinateTransformation"
search.OGRFieldDefnH = "OGRFieldDefnH* = pointer"
replace.OGRFieldDefnH = "OGRFieldDefn = object\n  OGRFieldDefnH* = ptr OGRFieldDefn"
search.OGRFeatureDefnH = "OGRFeatureDefnH* = pointer"
replace.OGRFeatureDefnH = "OGRFeatureDefn = object\n  OGRFeatureDefnH* = ptr OGRFeatureDefn"
search.OGRFeatureH = "OGRFeatureH* = pointer"
replace.OGRFeatureH = "OGRFeature = object\n  OGRFeatureH* = ptr OGRFeature"
search.OGRStyleTableH  = "OGRStyleTableH* = pointer"
replace.OGRStyleTableH = "OGRStyleTable = object\n  OGRStyleTableH* = ptr OGRStyleTable"
search.OGRGeomFieldDefnH = "OGRGeomFieldDefnH* = ptr OGRGeomFieldDefnHS"
replace.OGRGeomFieldDefnH = "OGRGeomFieldDefn = object\n  OGRGeomFieldDefnH* = ptr OGRGeomFieldDefn"
search.OGRLayerH = "OGRLayerH* = pointer"
replace.OGRLayerH = "OGRLayer = object\n  OGRLayerH* = ptr OGRLayer"
search.OGRDataSourceH = "OGRDataSourceH* = pointer"
replace.OGRDataSourceH = "OGRDataSource = object\n  OGRDataSourceH* = ptr OGRDataSource"
search.OGRSFDriverH = "OGRSFDriverH* = pointer"
replace.OGRSFDriverH = "OGRSFDriver = object\n  OGRSFDriverH* = ptr OGRSFDriver"
search.OGRStyleMgrH = "OGRStyleMgrH* = pointer"
replace.OGRStyleMgrH = "OGRStyleMgr = object\n  OGRStyleMgrH* = ptr OGRStyleMgr"
search.OGRStyleToolH = "OGRStyleToolH* = pointer"
replace.OGRStyleToolH = "OGRStyleTool = object\n  OGRStyleToolH* = ptr OGRStyleTool"

# regex.OGR_DS = """(proc )OGR_DS_([\s\S]+?\.\})"""
# replace.OGR_DS = "$1$2"

# [cpl_minixml.h]
# preprocess = true
# defines = true

[cpl_minixml.nim]
search.1 = "import wrap/cpl_port"
comment.1 = 1

# [cpl_progress.h]
# preprocess = true
# defines = true

[cpl_progress.nim]
search.1 = "import wrap/cpl_port"
comment.1 = 1

# [cpl_port.h]
# preprocess = true
# defines = true

[cpl_port.nim]
search.1 = "  _LARGEFILE64_SOURCE* = 1"
comment.1 = 3
search.2 = "  CPL_HAS_GINT64* = 1"
comment.2 = 1
search.3 = "  HAS_CPL_INLINE* = 1"
comment.3 = 1
search.4 = "  CPL_IS_LSB* = 0"
comment.4 = 1
search.5 = "  CPL_FINAL* = f"
comment.5 = 1
search.6 = "  FALSE* = f"
comment.6 = 1
search.when = "when defined(Windows):"
comment.when = 8

# [ogr_core.h]
# preprocess = true
# defines = true

[ogr_core.nim]
search.1 = "INNER_C_STRUCT_temp"
comment.1 = 34
search.2 = "  OGRField* {.bycopy.} = object {.union.}"
comment.2 = 12
search.3 = "OJUndefined = 0, OJLeft = 1, OJRight = 2"
append.2 = "\n  OGRField* {.bycopy.} = object"

search.import = "import wrap/cpl_port"
comment.import = 1
search.OFTMaxType = """
const
  OFTMaxType = OFTInteger64List
"""
comment.OFTMaxType = 2
search.OFSTMaxSubType = """
const
  OFSTMaxSubType = OFSTFloat32
"""
comment.OFSTMaxSubType = 2
search.OFSTMaxSubType_2 = """
const
  OFSTMaxSubType = OFSTJSON
"""
comment.OFSTMaxSubType_2 = 2