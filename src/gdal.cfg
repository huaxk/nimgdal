[n.global]
output = wrap

[n.include]
"${output}/gdal/gcore"

[n.prepare]
gitremote = "https://github.com/OSGeo/gdal.git"
gitsparse = """
gdal/gcore/*
gdal/ogr/*
gdal/port/*
"""

[n.exclude]
cpl_config.h
gdal_version.h

[n.wildcard]
wildcard = "gdal.h"
search.RESTRICT = "CPL_RESTRICT"
replace.RESTRICT = ""
search.CPL_WARN_UNUSED_RESULT = "CPL_WARN_UNUSED_RESULT"
replace.CPL_WARN_UNUSED_RESULT = ""
search.GDALGetRasterHistogram = """CPL_WARN_DEPRECATED("Use GDALGetRasterHistogramEx() instead")"""
replace.GDALGetRasterHistogram = ""
search.GDALGetDefaultHistogram = """CPL_WARN_DEPRECATED("Use GDALGetDefaultHistogramEx() instead")"""
replace.GDALGetDefaultHistogram = ""
search.GDALSetDefaultHistogram = """CPL_WARN_DEPRECATED("Use GDALSetDefaultHistogramEx() instead")"""
replace.GDALSetDefaultHistogram = ""

[gdal.h]
preprocess = true
defines = true

dynlib.win = libgdal.dll
dynlib.lin = libgdal.so
dynlib.osx = libgdal.dylib

[gdal.nim]
prepend = """
import cpl_port
import cpl_error
import cpl_progress
import cpl_virtualmem
import cpl_minixml
import ogr_api
"""

[cpl_virtualmem.h]
preprocess = true
defines = true

[cpl_virtualmem.nim]
prepend = """
import cpl_port
"""
search.CPLVirtualMem = "type"
append.CPLVirtualMem = """

  CPLVirtualMem* = object
  VSILFILE* = FILE
  vsi_l_offset* = GUIntBig
"""

[cpl_error.h]
preprocess = true
defines = true

[cpl_error.nim]
search.va_list = "va_list"
replace.va_list = "cstring"
search.CPLAssert = "_CPLAssert"
replace.CPLAssert = "CPLAssert"

[ogr_api.h]
preprocess = true
defines = true

[ogr_api.nim]
search.1 = "  _CPLXMLNode* {.bycopy.} = object"
comment.1 = 1
search.2 = "  OGRGeomFieldDefnH* = ptr OGRGeomFieldDefnHS"
replace.2 = "  OGRGeomFieldDefnH* = pointer"
search.import = "import gdalout/cpl_progress"
comment.import = 3
prepend = """
import cpl_progress
import cpl_minixml
import cpl_port
import ogr_core
"""

[cpl_minixml.h]
preprocess = true
defines = true

[cpl_minixml.nim]
search.1 = "import gdalout/cpl_port"
comment.1 = 1

[cpl_progress.h]
preprocess = true
defines = true

[cpl_progress.nim]
search.1 = "import gdalout/cpl_port"
comment.1 = 1

[cpl_port.h]
preprocess = true
defines = true

[cpl_port.nim]
search.1 = "  _LARGEFILE64_SOURCE* = 1"
comment.1 = 3
search.2 = "  CPL_HAS_GINT64* = 1"
comment.2 = 1
search.3 = "  HAS_CPL_INLINE* = 1"
comment.3 = 1
search.4 = "  CPL_IS_LSB* = 0"
comment.4 = 1
search.5 = "  CPL_FINAL* = f"
comment.5 = 1
search.6 = "  FALSE* = f"
comment.6 = 1

[ogr_core.h]
preprocess = true
defines = true

[ogr_core.nim]
search.1 = "  INNER_C_STRUCT_temp-ogr_core.nim_218* {.bycopy.} = object"
comment.1 = 34
search.2 = """
  OGRField* {.bycopy.} = object {.union.}
    Integer*: cint
    Integer64*: GIntBig
    Real*: cdouble
    String*: cstring
    IntegerList*: INNER_C_STRUCT_temp-ogr_core.nim_218
    Integer64List*: INNER_C_STRUCT_temp-ogr_core.nim_222
    RealList*: INNER_C_STRUCT_temp-ogr_core.nim_226
    StringList*: INNER_C_STRUCT_temp-ogr_core.nim_230
    Binary*: INNER_C_STRUCT_temp-ogr_core.nim_234
    Set*: INNER_C_STRUCT_temp-ogr_core.nim_238
    Date*: INNER_C_STRUCT_temp-ogr_core.nim_243
"""
replace.2 = "  OGRField* {.bycopy.} = object"

search.import = "import gdalout/cpl_port"
replace.import = ""
